/*! Flyleaf v0.1 Production 2013-07-15 20:38 */
(function(e,t){"use strict";var n,i="0.1.20130715-2038",r=e.Flyleaf||"Fly",o={},a=o,s={},l=Array.prototype.slice,c=t(document),p=t.isFunction(Object.create);e[r]=o,t.extend(o,{global:e,version:i,clickEvent:"tap",doc:c,body:void 0,emptyFn:t.noop,isString:function(e){return"string"===t.type(e)},isObject:function(e){return"object"===t.type(e)},isFunction:t.isFunction,isNumeric:t.isNumeric,isArray:t.isArray,each:_.each,protoInherit:function(e,n){var i=function(){e.apply(this,arguments)};return i.prototype=e.prototype,t.extend(i.prototype,n),i},instanceOf:function(e,t){return e&&t?p?t.isPrototypeOf(e):e instanceof t:!1},isCollection:function(e){return e instanceof Backbone.Collection||e.prototype instanceof Backbone.Collection},isMobile:function(){var e=navigator&&(navigator.userAgent||navigator.vendor)||window&&window.opera||"";return void 0===n&&(n=/android|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(ad|hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|symbian|tablet|treo|up\.(browser|link)|vodafone|wap|webos|windows (ce|phone)|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|e\-|e\/|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(di|rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|xda(\-|2|g)|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))),n}}),o.objCreate=p?Object.create:a.protoInherit,t(function(){a.body=t("body"),a.isMobile()&&setTimeout(function(){pageYOffset||window.scrollTo(0,1)},100),Hammer&&Hammer.READY===!1&&o.body.hammer()}),o.util={},t.extend(o,{ns:function(e,t){if(!a.isString(e))throw Error("Invalid namespace, must be a string");if(s.hasOwnProperty(e))return s[e];var n,i,r,o=e.split("."),l=o.length-1,c=o[l],p=window;if(l>0)for(r=0;l>r;r+=1)n=o[r],i=p[n],a.isObject(i)||(p[n]={}),p=p[n];return p[c]=p[c]||t,p=p[c],s[e]=p,p},def:function(e,n){var i,r=o.BaseClass||{},s=n&&n.extend?o.ns(n.extend):r;return a.isObject(n)||(n={}),a.isFunction(s)?(i=a.protoInherit(s,n),i.prototype.$super=s,i.prototype.$className=e):(i=t.extend(a.objCreate(s),n),i.$super=s,i.$className=e),o.ns(e,i),i.singleton===!0&&(i.construct&&i.construct(n),i.init&&i.init(n)),i},init:function(e,t){var n,i;if(a.isObject(e))n=e;else{if(!a.isString(e)||1>e.length)return a.error("Invalid class name '"+(""+e)+"' specified, must be a non-empty string");n=a.getClass(e)}return n?n.singleton?a.error("Cannot instantiate singleton "+e):(i=a.objCreate(n),a.isFunction(i.construct)&&i.construct(t),i):a.error("Cannot create an instance of unrecognized class name: "+(""+e))},getClass:function(e){var t=o.App.name;return o.ns(e)||(t?o.ns(t+"."+e):!1)||o.ns("Fly."+e)||(t?o.ns(t+".view."+e):!1)||o.ns("Fly.view."+e)||o.ns("App."+e)}});var u=/^[\w]*/,d=/(?:[\[](?:@)?([\w\-]+)\s?(?:(=|.=)\s?['"]?(.*?)["']?)?[\]])/,m=/^[#\.a-zA-Z]/,f={},h=[];o.def("Fly.Registry",{singleton:!0,views:void 0,controllers:void 0,controls:[],init:function(){var e=this;e.views=new Backbone.Collection,e.controllers=new Backbone.Collection,e.views.on("all",e.clearCache,e)},add:function(e){this.views.add({id:e.id,className:e.$className,instance:e}),this.registerViewListeners(e)},remove:function(e){var t=this.views,n=t.where({id:e.id});t.remove(n)},parseQuery:function(e){var t,n,i=e.match(u);return i?(t=e.match(d),n={cmp:a.getClass(i[0])},n.cmp?(t&&(n.attr={},n.attr[t[1]]=t[3]),n):!1):!1},doQuery:function(e,n){var i=this,r=i.parseQuery(e),o=n?new Backbone.Collection(n):i.views,s=[],l=[];return r?(o.each(function(e){var t=e.get("instance");a.instanceOf(t,r.cmp)&&s.push(t)}),r.attr?(a.each(r.attr,function(e,n){t.grep(s,function(t){t[n]==e&&l.push(t)})}),l):s):!1},query:function(e,t){var n=f[e];return n||(n=f[e]=this.doQuery(e,t)),n},first:function(e){var t=this.query(e);return t?t[0]:!1},clearCache:function(){f={}},addController:function(e){var n=this;t.each(e.control,t.proxy(n.fixControlScope,n,e)),n.controllers.add({name:e.$className,control:e.control,instance:e}),n.controls.push(e.control)},fixControlScope:function(e,n,i){t.each(i,t.proxy(this.fixEventScope,this,e,i))},fixEventScope:function(e,t,n,i){a.isString(i)&&(t[n]={fn:e[i],scope:e})},parseControls:function(e){a.each(e,this.registerControllerListener,this)},registerControllerListener:function(e,n,i,r){var s,l=this,c=n.match(m),p=c?!1:n.replace("$","");a.each(e,function(e,i){var u,d=l[e]||e.fn,m=a.isString(e)?t.proxy(l[e],l):t.proxy(e.fn,e.scope);return c?(u=function(e){return e.event===i&&e.query===n&&e.cb===d},_.find(h,u)?!1:(h.push({event:i,query:n,cb:d}),o.body.on(i,n,m))):(s=a.Registry.doQuery(p,r),s&&t.grep(s,function(e){e.on(i,m)}),void 0)})},registerViewListeners:function(e){var n=this,i=function(t,i,r){n.registerControllerListener(t,i,r,[{id:e.id,className:e.$className,instance:e}])};t.grep(n.controls,function(e){a.each(e,i)})}});var g=["tap","tapstart","tapend","singletap","doubletap","taphold","swipe","swipeup","swipedown","swipeleft","swiperight","swipeend","scrollstart","scrollend","orientationchange","dblclick","click","mousemove","mouseout","mousein","mouseover"],v=Backbone.Events;o.def("Fly.Events",{deferredEventRelays:[],off:v.off,trigger:v.trigger,init:function(){this.relays||(this.relays=[])},on:function(e){this.relay(e),v.on.apply(this,arguments)},once:function(e){this.relay(e),v.once.apply(this,arguments)},relay:function(e){var n=this,i=n.el||n.$el,r=t.inArray(e,g)>-1,o=r&&i,a=r&&!i,s=o?t.inArray(e,n.relays)>-1:!1;return a?(n.deferredEventRelays.push(e),-1):s||!o?!1:(i.on(e,function(t){n.trigger(e,n,t,this)}),n.relays.push(e),!0)}}),o.def("Fly.BaseClass",{singleton:!1,listeners:!1,construct:function(e){var t=this;return t.mixin(o.Events),t.initConfig(e),t.initListeners(t.listeners),t.trigger("beforeinit",t,arguments),t.init&&t.init(e,t),t},callParent:function(e,t,n){var i=this.$super,r=this[e],o=i[e];return o===r?i.callParent(e,t,n):(o&&o.apply(n||this,t),void 0)},initConfig:function(e){t.extend(this,e)},initListeners:function(e){var t=this,n=a.global;a.each(e,function(e,i){a.isObject(e)?t.on(i,e.fn,e.scope||n):t.on(i,e)})},mixin:function(){var e,t,n,i=this,r=l.call(arguments);for(t=0;r.length>t;t+=1){e=r[t];for(n in e)e.hasOwnProperty(n)&&void 0===i[n]&&(i[n]=e[n]);a.isFunction(e.init)&&e.init.call(i)}}}),o.def("Fly.TimerManager",{batch:350,timerID:0,queue:[],runner:void 0,init:function(){var e=this;e.runner=t.proxy(e.runNext,e)},add:function(e,t){this.queue.push(e),t&&this.start()},start:function(){var e=this;e.timerID||(e.trigger("start",e),e.timerID=setTimeout(e.runner,0))},stop:function(){var e=this;clearTimeout(e.timerID),e.timerID=0,e.trigger("stop",e)},runNext:function(){var e,t,n=this,i=n.queue;if(i.length>0){for(e=i.splice(0,n.batch),t=0;e.length>t;t+=1)e[t]();n.timerID=setTimeout(n.runner,0)}else n.timerID=0,n.trigger("finish",n)}}),o.def("Fly.App",{singleton:!0,name:void 0,views:{},models:{},stores:{},controllers:{},setup:function(e){var n=this,i=e.name;t.extend(n,e),a.isString(i)&&i.length||(i="App"),a.ns(i+".app",n),t.isFunction(n.launch)&&t(t.proxy(n.launch,n)),n.name=i},launch:void 0}),o.ThreadManager=o.init("TimerManager"),o.thread=function(e){o.ThreadManager.add(e,1)},o.def("Fly.Controller",{singleton:!0,control:{},construct:function(){this!==o.Controller&&o.Registry.addController(this)}}),t.extend(o,{logLevel:["error","warn","log"],errorFn:console?t.proxy(console.error,console):a.emptyFn,warnFn:console?t.proxy(console.warn,console):a.emptyFn,logFn:console?t.proxy(console.log,console):a.emptyFn,throwOnError:!0,error:function(e){var n;if(a.throwOnError)throw Error(e);return t.inArray("error",a.logLevel)>-1?(n=l.call(arguments),a.errorFn.apply(this,n)):void 0},warn:function(){return t.inArray("warn",a.logLevel)>-1?a.warnFn.apply(this,arguments):void 0},log:function(){return t.inArray("log",a.logLevel)>-1?a.logFn.apply(this,arguments):void 0}}),o.def("Fly.view.View",{tpl:void 0,tplEngine:"Underscore",tplCompileDeferred:!1,data:void 0,html:void 0,applyTo:void 0,el:void 0,$el:void 0,id:void 0,autoShow:!1,items:[],module:void 0,tag:"div",cls:void 0,$painted:!1,init:function(){var e=this;e.id=e.id||_.uniqueId("view_"),a.Registry.add(e),a.isString(e.tpl)?e.initTpl():a.isString(e.html)&&e.setHtml()},initTpl:function(){var e=this,t="Fly.tpl."+e.tplEngine;e.$tpl=e.tpl,e.tpl=o.init(t,{compileDeferred:!0,autoRender:!0,tpl:e.tpl,data:e.data,listeners:{render:{fn:e.onTplRender,scope:e}}})},setData:function(e){var t=this;e&&(t.data=e),t.tpl&&t.tpl.setData(e,!0),t.reset(),(t.autoShow===!0||t.el)&&t.paint(),t.trigger("update",t,t.data,t.tpl)},onTplRender:function(e,t){var n,i,r=this;return r.el?(i=pageYOffset,n=pageXOffset,r.el.html(t),window.scrollTo(n,i||1)):(r.setHtml(t),r.trigger("update",r,r.data,r.tpl),void 0)},setHtml:function(e){var n=this,i=e||n.html,r=n.$el,a=n.id||_.uniqueId("view_"),s=n.tag;return i||n.items.length?(r||(n.$el=r=t(document.createElement(s)).attr("id",a),n.addCls(n.cls,n.$el),n.setDefferredRelays()),r.html(i),(n.autoShow===!0||n.$painted)&&o.thread(function(){n.paint()}),n):!1},addCls:function(e,t){var n=this;e=e||n.cls,t=t||n.el,t.addClass(e)},reset:function(){var e=this;e.remove(),delete e.el},paint:function(e){var t,n=this,i=n.items;return n.$painted=!0,n.el?n:n.$el||(t=n.setHtml(),t||i.length)?(e=e||n.applyTo||a.body,n.trigger("beforepainted",n,n.$el,n.html),n.el=n.$el.clone(!0),n.add(n.$items||i),n.el.appendTo(e),n.trigger("painted",n,n.$el,n.html),n):n},setDefferredRelays:function(){var e=this,n=e.deferredEventRelays;t.each(n,function(t,n){e.relay(n)})},destroy:function(){var e=this;e.off(),e.$painted=!1,e.reset(),delete e.$el},hide:function(){this.el.hide()},remove:function(){var e=this;return e.el&&e.el.remove(),delete e.el,a.Registry.remove(e),e},show:function(){var e=this;return e.el?(e.el.show(),e):e.paint()},showAt:function(){var e=this,n=arguments,i=t.isNumeric(n[0])&&t.isNumeric(n[1])?n:e.xy;return e.el?e.doShowAt(i[0],i[1]):(e.paint(),e.once("painted",function(){e.doShowAt(i[0],i[1])})),e},doShowAt:function(e,t){this.el.css({top:t+"px",left:e+"px",position:"absolute"})},add:function(){var e,n,i=this,r=l.call(arguments);if(t.isNumeric(r[0])&&r.splice(0,1),e=r.length,e>1)return t.each(r,t.proxy(i.add,i)),i;if(t.isArray(r[0]))return t.each(r[0],t.proxy(i.add,i)),i;if(n=r[0],!n)return!1;if(!a.instanceOf(n,o.view.View)){if(n.module||(n.module="View"),!n.module)return o.error("Item not recognized",n,i);n=o.init(n.module,n)}n.paint(i.el)},getEl:function(){return this.el}}),o.def("Fly.view.List",{extend:"Fly.view.View",tag:"ul",itemTpl:"",itemCls:"",init:function(){var e=this;e.data=e.convertToCollection(e.data),e.setCollectionChangeEvent(),e.formatTpl(),e.callParent("init",arguments,e),e.on("beforepainted",function(e,t){t.delegate("li","tap",function(t){var n=this,i=e.data.get(n.getAttribute("data-id"));e.trigger("itemtap",i,n,e,t)})})},formatTpl:function(){var e=this;e.tpl=["{{#each .}}","<li ",e.itemCls?' class="'+e.itemCls+'" ':"",'data-id="{{modelId}}">',e.itemTpl,"</li>","{{/each}}"].join("")},convertToCollection:function(){var e=this,t=arguments[0]||e.data;return o.isCollection(e.data)?e.data:new Backbone.Collection(t)},onCollectionChange:function(e,t,n){n=n instanceof Backbone.Collection?n:this.data,this.tpl.setData(n,!0)},setCollectionChangeEvent:function(){this.data.on("all",this.onCollectionChange,this)}}),o.def("Fly.tpl.Abstract",{tpl:"",data:void 0,autoRender:!1,autoCompile:!1,compileDeferred:!1,html:void 0,engine:void 0,compiled:void 0,compile:o.emptyFn,init:function(){var e=this;return e.compileDeferred?o.thread(function(){e.doCompile(),e.initTpl()}):((e.autoRender===!0||e.autoCompile===!0)&&e.doCompile(),e.initTpl(),void 0)},initTpl:function(){var e=this;e.data&&e.setData(e.data,e.autoRender)},setData:function(e,t){var n,i=this;return a.isFunction(i.applyData)&&(e=i.applyData(e),e===!1)?e:(i.data=e,i.trigger("setdata",i,e),t?(n=o.isCollection(e)?e.map(function(e){var t=e.toJSON();return t.modelId=e.cid,t}):e,i.render(n)):e)},render:function(e){var t=this;return t.compiled||t.doCompile(),e||(e=t.data),t.html=t.compiled(e),t.trigger("render",t,t.html,e),t.html},doCompile:function(){var e=this;e.compile(),e.trigger("compile",e)}}),o.def("Fly.tpl.Handlebars",{extend:"Fly.tpl.Abstract",precompiled:!1,init:function(){var e=this;e.callParent("init",arguments,e),e.engine=Handlebars},compile:function(e){var t=this;return t.precompiled?t.precompiled:(e||(e=t.tpl),t.compiled=Handlebars.compile(e),t.compiled)}}),o.def("Fly.tpl.Underscore",{extend:"Fly.tpl.Abstract",likeExt:!1,init:function(){var e=this;e.callParent("init",arguments,e),e.likeExt&&e.lookLikeExtTpl(),e.engine=_.template},compile:function(e){var t=this;return e||(e=t.tpl),t.compiled=_.template(e),t.compiled},lookLikeExtTpl:function(){_.templateSettings={interpolate:/\{(.+?)\}/g,evaluate:/\{\[(.+?)\]\}/g}}})})(this,jQuery);